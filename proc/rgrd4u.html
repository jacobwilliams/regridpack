<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Modern Fortran Edition of REGRIDPACK">
    
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>rgrd4u &ndash; regridpack</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">regridpack </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../sourcefile/regridpack_module.f90.html">Source File</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
               
        
        
            </ul>
        
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../sourcefile/regridpack_module.f90.html">Source File</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             



          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>rgrd4u
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 9.0% of total for procedures.">221 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/regridpack_module.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/regridpack_module.f90.html'>regridpack_module.f90</a></li>
    
     <li><a href='../module/regridpack_module.html'>regridpack_module</a></li>
    
  
     <li class="active">rgrd4u</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/rgrd4u.html#src">rgrd4u</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
private subroutine rgrd4u(nx, ny, nz, nt, p, mx, my, mz, mt, q, intpol, w, lw, iw, liw, ier)
    
    
   
</h2>
    
  


    
    <p>subroutine rgrd4u interpolates the nx by ny by nz by nt array p onto
  the mx by my by mz by mt array q.  it is assumed that p and q are
  values on uniform nx by ny by nz by nt and mx by my by mz by mt grids
  which are superimposed on the same box region (INCLUDING BOUNDARIES).
  if p and q are values on nonuniform orthogonal grids and/or if the grid
  on which q is defined lies within the p grid then subroutine rgrd4
  should be used.</p>
<h3>method</h3>
<p>linear or cubic interpolation (see intpol) is used in each
  direction for which the q grid is not a subgrid of the p grid.
  [the mx (my,mz,mt) uniform grid is a subgrid of the nx (ny,nz,nt)
  uniform grid if and only if mx-1 (my-1,nz-1,nt-1) divides nx-1
  (ny-1,nz-1,nt-1)].  Values are set directly without (the need for)
  interpolation in subgrid directions.</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-nx~26"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>nx</strong></td><td><p>the integer first dimension of p.  nx &gt; 1 if intpol(1) = 1 or
nx &gt; 3 if intpol(1) = 3 is required (see ier = 2).</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-ny~16"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>ny</strong></td><td><p>the integer second dimension of p.  ny &gt; 1 if intpol(2) = 1 or
ny &gt; 3 if intpol(2) = 3 is required (see ier = 2).</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-nz~10"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>nz</strong></td><td><p>the integer third dimension of p.  nz &gt; 1 if intpol(3) = 1 or
nz &gt; 3 if intpol(3) = 3 is required (see ier = 2)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-nt~4"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>nt</strong></td><td><p>the integer fourth dimension of p.  nt &gt; 1 if intpol(4) = 1 or
nt &gt; 3 if intpol(4) = 3 is required (see ier=2)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-p~26"></span>real(kind=wp),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>p</strong>(nx,ny,nz,nt)</td><td><p>a real(wp) nx by ny by nz by nt array of given values</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-mx~26"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>mx</strong></td><td><p>the integer first dimension of q.  mx &gt; 1 is required (see ier = 1)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-my~16"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>my</strong></td><td><p>the integer second dimension of q. my &gt; 1 is required (see ier = 1)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-mz~10"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>mz</strong></td><td><p>the integer third dimension of q. mz &gt; 1 is required (see ier = 1)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-mt~4"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>mt</strong></td><td><p>the integer fourth dimension of q. mt &gt; 1 is required (see ier = 1)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-q~26"></span>real(kind=wp),</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>q</strong>(mx,my,mz,mt)</td><td><p>a real(wp) mx by my by mz by mt array of values which are interpolated from p.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-intpol~22"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>intpol</strong>(4)</td><td><p>an integer vector of dimension 4 which sets linear or cubic
interpolation in each of the x,y,z,t directions as follows:</p>
<ul>
<li>intpol(1) = 1 sets linear interpolation in the x direction</li>
<li>intpol(1) = 3 sets cubic interpolation in the x direction.</li>
<li>intpol(2) = 1 sets linear interpolation in the y direction</li>
<li>intpol(2) = 3 sets cubic interpolation in the y direction.</li>
<li>intpol(3) = 1 sets linear interpolation in the z direction</li>
<li>intpol(3) = 3 sets cubic interpolation in the z direction.</li>
<li>intpol(4) = 1 sets linear interpolation in the t direction</li>
<li>intpol(4) = 3 sets cubic interpolation in the t direction.</li>
</ul>
<p>values other than 1 or 3 in intpol are not allowed (ier = 3).</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-w~8"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>w</strong>(lw)</td><td><p>a real(wp) work space of length at least lw
which must be provided in the routine calling rgrd4u</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-lw~8"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>lw</strong></td><td><p>the integer length of the work space w.</p>
<ul>
<li>let lwx = 1 if mx-1 divides nx-1; otherwise
  let lwx = mx if intpol(1) = 1 or
  let lwx = 4*mx if intpol(1) = 3</li>
<li>let lwy = 0 if my-1 divides ny-1; otherwise
  let lwy = my+2<em>mx if intpol(2) = 1 or
  let lwy = 4</em>(mx+my) if intpol(2) = 3</li>
<li>let lwz = 0 if mz-1 divides nz-1; otherwise
  let lwz = 2<em>mx</em>my+mz if intpol(3) = 1 or
  let lwz = 4<em>(mx</em>my+mz) if intpol(3) = 3</li>
<li>let lwt = 0 if mt-1 divides nt-1; otherwise
  let lwt = 2<em>mx</em>my<em>mz+mt if intpol(4) = 1 or
  let lwt = 4</em>(mx<em>my</em>mz+mt) if intpol(4) = 3</li>
</ul>
<p>then lw must be greater than or equal to lwx+lwy+lwz+lwt</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-iw~8"></span>integer,</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>iw</strong>(liw)</td><td><p>an integer work space of length at least liw
which must be provided in the routine calling rgrd4u</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-liw~8"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>liw</strong></td><td><p>the integer length of the integer work space iw.
liw must be at least mx+my+mz+mt</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-ier~12"></span>integer,</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>ier</strong></td><td><p>an integer error flag set as follows:</p>
<ul>
<li>ier = 0 if no errors in input arguments are detected</li>
<li>ier = 1 if min(mx,my,mz,mt) &lt; 2</li>
<li>ier = 2 if nx &lt; 2 when intpol(1)=1 or nx &lt; 4 when intpol(1)=3 (or)
                    ny &lt; 2 when intpol(2)=1 or ny &lt; 4 when intpol(2)=3 (or)
                    nz &lt; 2 when intpol(3)=1 or nz &lt; 4 when intpol(3)=3 (or)
                    nt &lt; 2 when intpol(4)=1 or nt &lt; 4 when intpol(4)=3.</li>
<li>ier = 3 if any of intpol(1),intpol(2),intpol(3),intpol(4)  is not
                equal to 1 or 3.</li>
<li>ier = 4 if lw or liw is too small (insufficient work space)</li>
</ul></td>
  
</tr>

</tbody>
</table>

    
    
    
    
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/rgrd4u.html#src">rgrd4u</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>    <span class="k">subroutine </span><span class="n">rgrd4u</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">mt</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">intpol</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">lw</span><span class="p">,</span><span class="n">iw</span><span class="p">,</span><span class="n">liw</span><span class="p">,</span><span class="n">ier</span><span class="p">)</span>

    <span class="k">implicit none</span>

<span class="k">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">nx</span>   <span class="c">!! the integer first dimension of p.  nx &gt; 1 if intpol(1) = 1 or</span>
                                    <span class="c">!! nx &gt; 3 if intpol(1) = 3 is required (see ier = 2).</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">ny</span>   <span class="c">!! the integer second dimension of p.  ny &gt; 1 if intpol(2) = 1 or</span>
                                    <span class="c">!! ny &gt; 3 if intpol(2) = 3 is required (see ier = 2).</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">nz</span>   <span class="c">!! the integer third dimension of p.  nz &gt; 1 if intpol(3) = 1 or</span>
                                    <span class="c">!! nz &gt; 3 if intpol(3) = 3 is required (see ier = 2)</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">nt</span>   <span class="c">!! the integer fourth dimension of p.  nt &gt; 1 if intpol(4) = 1 or</span>
                                    <span class="c">!! nt &gt; 3 if intpol(4) = 3 is required (see ier=2)</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">mx</span>   <span class="c">!! the integer first dimension of q.  mx &gt; 1 is required (see ier = 1)</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">my</span>   <span class="c">!! the integer second dimension of q. my &gt; 1 is required (see ier = 1)</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">mz</span>   <span class="c">!! the integer third dimension of q. mz &gt; 1 is required (see ier = 1)</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">mt</span>   <span class="c">!! the integer fourth dimension of q. mt &gt; 1 is required (see ier = 1)</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">intpol</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>    <span class="c">!! an integer vector of dimension 4 which sets linear or cubic</span>
                                            <span class="c">!! interpolation in each of the x,y,z,t directions as follows:</span>
                                            <span class="c">!!</span>
                                            <span class="c">!! * intpol(1) = 1 sets linear interpolation in the x direction</span>
                                            <span class="c">!! * intpol(1) = 3 sets cubic interpolation in the x direction.</span>
                                            <span class="c">!! * intpol(2) = 1 sets linear interpolation in the y direction</span>
                                            <span class="c">!! * intpol(2) = 3 sets cubic interpolation in the y direction.</span>
                                            <span class="c">!! * intpol(3) = 1 sets linear interpolation in the z direction</span>
                                            <span class="c">!! * intpol(3) = 3 sets cubic interpolation in the z direction.</span>
                                            <span class="c">!! * intpol(4) = 1 sets linear interpolation in the t direction</span>
                                            <span class="c">!! * intpol(4) = 3 sets cubic interpolation in the t direction.</span>
                                            <span class="c">!!</span>
                                            <span class="c">!! values other than 1 or 3 in intpol are not allowed (ier = 3).</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">liw</span>          <span class="c">!! the integer length of the integer work space iw.</span>
                                            <span class="c">!! liw must be at least mx+my+mz+mt</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">iw</span><span class="p">(</span><span class="n">liw</span><span class="p">)</span>      <span class="c">!! an integer work space of length at least liw</span>
                                            <span class="c">!! which must be provided in the routine calling rgrd4u</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">lw</span>           <span class="c">!! the integer length of the work space w.</span>
                                            <span class="c">!!</span>
                                            <span class="c">!! * let lwx = 1 if mx-1 divides nx-1; otherwise</span>
                                            <span class="c">!!   let lwx = mx if intpol(1) = 1 or</span>
                                            <span class="c">!!   let lwx = 4*mx if intpol(1) = 3</span>
                                            <span class="c">!! * let lwy = 0 if my-1 divides ny-1; otherwise</span>
                                            <span class="c">!!   let lwy = my+2*mx if intpol(2) = 1 or</span>
                                            <span class="c">!!   let lwy = 4*(mx+my) if intpol(2) = 3</span>
                                            <span class="c">!! * let lwz = 0 if mz-1 divides nz-1; otherwise</span>
                                            <span class="c">!!   let lwz = 2*mx*my+mz if intpol(3) = 1 or</span>
                                            <span class="c">!!   let lwz = 4*(mx*my+mz) if intpol(3) = 3</span>
                                            <span class="c">!! * let lwt = 0 if mt-1 divides nt-1; otherwise</span>
                                            <span class="c">!!   let lwt = 2*mx*my*mz+mt if intpol(4) = 1 or</span>
                                            <span class="c">!!   let lwt = 4*(mx*my*mz+mt) if intpol(4) = 3</span>
                                            <span class="c">!!</span>
                                            <span class="c">!! then lw must be greater than or equal to lwx+lwy+lwz+lwt</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">ier</span>          <span class="c">!! an integer error flag set as follows:</span>
                                            <span class="c">!!</span>
                                            <span class="c">!! * ier = 0 if no errors in input arguments are detected</span>
                                            <span class="c">!! * ier = 1 if min(mx,my,mz,mt) &lt; 2</span>
                                            <span class="c">!! * ier = 2 if nx &lt; 2 when intpol(1)=1 or nx &lt; 4 when intpol(1)=3 (or)</span>
                                            <span class="c">!!                     ny &lt; 2 when intpol(2)=1 or ny &lt; 4 when intpol(2)=3 (or)</span>
                                            <span class="c">!!                     nz &lt; 2 when intpol(3)=1 or nz &lt; 4 when intpol(3)=3 (or)</span>
                                            <span class="c">!!                     nt &lt; 2 when intpol(4)=1 or nt &lt; 4 when intpol(4)=3.</span>
                                            <span class="c">!! * ier = 3 if any of intpol(1),intpol(2),intpol(3),intpol(4)  is not</span>
                                            <span class="c">!!                 equal to 1 or 3.</span>
                                            <span class="c">!! * ier = 4 if lw or liw is too small (insufficient work space)</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">p</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">nt</span><span class="p">)</span>   <span class="c">!! a real(wp) nx by ny by nz by nt array of given values</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">q</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">mt</span><span class="p">)</span>   <span class="c">!! a real(wp) mx by my by mz by mt array of values which are interpolated from p.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">w</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span>    <span class="c">!! a real(wp) work space of length at least lw</span>
                                        <span class="c">!! which must be provided in the routine calling rgrd4u</span>


    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">inmx</span><span class="p">,</span><span class="n">jnmy</span><span class="p">,</span><span class="n">knmz</span><span class="p">,</span><span class="n">lnmt</span><span class="p">,</span><span class="n">isubx</span><span class="p">,</span><span class="n">jsuby</span><span class="p">,</span><span class="n">ksubz</span><span class="p">,</span><span class="n">lsubt</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mxmy</span><span class="p">,</span><span class="n">mxmymz</span><span class="p">,</span><span class="n">lwx</span><span class="p">,</span><span class="n">lwy</span><span class="p">,</span><span class="n">lwz</span><span class="p">,</span><span class="n">lwt</span><span class="p">,</span><span class="n">jy</span><span class="p">,</span><span class="n">kz</span><span class="p">,</span><span class="n">lt</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i2</span><span class="p">,</span><span class="n">i3</span><span class="p">,</span><span class="n">i4</span><span class="p">,</span><span class="n">i5</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">j2</span><span class="p">,</span><span class="n">j3</span><span class="p">,</span><span class="n">j4</span><span class="p">,</span><span class="n">j5</span><span class="p">,</span><span class="n">j6</span><span class="p">,</span><span class="n">j7</span><span class="p">,</span><span class="n">j8</span><span class="p">,</span><span class="n">j9</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">k2</span><span class="p">,</span><span class="n">k3</span><span class="p">,</span><span class="n">k4</span><span class="p">,</span><span class="n">k5</span><span class="p">,</span><span class="n">k6</span><span class="p">,</span><span class="n">k7</span><span class="p">,</span><span class="n">k8</span><span class="p">,</span><span class="n">k9</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">l2</span><span class="p">,</span><span class="n">l3</span><span class="p">,</span><span class="n">l4</span><span class="p">,</span><span class="n">l5</span><span class="p">,</span><span class="n">l6</span><span class="p">,</span><span class="n">l7</span><span class="p">,</span><span class="n">l8</span><span class="p">,</span><span class="n">l9</span>

    <span class="c">! check input arguments</span>

    <span class="c">! check mx,my,mz,mt</span>
    <span class="n">ier</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">mt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span>

    <span class="c">! check intpol</span>
    <span class="n">ier</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/=</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">intpol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/=</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/=</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">intpol</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/=</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/=</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">intpol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/=</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">/=</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">intpol</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">/=</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span>

    <span class="c">! check nx,ny,nz,nt</span>
    <span class="n">ier</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">nx</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">nx</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ny</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ny</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">nz</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">nz</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">nt</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">nt</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span> <span class="k">return</span>

    <span class="c">! set subgrid indicators</span>
    <span class="n">inmx</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">jnmy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">my</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">knmz</span> <span class="o">=</span> <span class="p">(</span><span class="n">nz</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mz</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lnmt</span> <span class="o">=</span> <span class="p">(</span><span class="n">nt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">isubx</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">-</span> <span class="n">inmx</span><span class="o">*</span><span class="p">(</span><span class="n">mx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">jsuby</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">-</span> <span class="n">jnmy</span><span class="o">*</span><span class="p">(</span><span class="n">my</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ksubz</span> <span class="o">=</span> <span class="n">nz</span> <span class="o">-</span> <span class="n">knmz</span><span class="o">*</span><span class="p">(</span><span class="n">mz</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lsubt</span> <span class="o">=</span> <span class="n">nt</span> <span class="o">-</span> <span class="n">lnmt</span><span class="o">*</span><span class="p">(</span><span class="n">mt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c">! check work space length input</span>
    <span class="n">ier</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">mxmy</span> <span class="o">=</span> <span class="n">mx</span><span class="o">*</span><span class="n">my</span>
    <span class="n">mxmymz</span> <span class="o">=</span> <span class="n">mxmy</span><span class="o">*</span><span class="n">mz</span>
    <span class="n">lwx</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isubx</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">lwx</span> <span class="o">=</span> <span class="n">mx</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">lwx</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">mx</span>
        <span class="k">end if</span>
<span class="k">    end if</span>
<span class="k">    </span><span class="n">lwy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">jsuby</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">lwy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mx</span><span class="o">+</span><span class="n">my</span><span class="p">)</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">lwy</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">my</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">mx</span>
        <span class="k">end if</span>
<span class="k">    end if</span>
<span class="k">    </span><span class="n">lwz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ksubz</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">lwz</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mxmy</span><span class="o">+</span><span class="n">mz</span><span class="p">)</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">lwz</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">mxmy</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">mz</span>
        <span class="k">end if</span>
<span class="k">    end if</span>
<span class="k">    </span><span class="n">lwt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lsubt</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">lwt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mxmymz</span><span class="o">+</span><span class="n">mt</span><span class="p">)</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">lwt</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">mxmymz</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">mt</span>
        <span class="k">end if</span>
<span class="k">    end if</span>

<span class="k">    if</span> <span class="p">(</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">lwx</span><span class="o">+</span><span class="n">lwy</span><span class="o">+</span><span class="n">lwz</span><span class="o">+</span><span class="n">lwt</span><span class="p">)</span> <span class="k">return</span>
<span class="k">    if</span> <span class="p">(</span><span class="n">liw</span> <span class="o">&lt;</span> <span class="n">mx</span><span class="o">+</span><span class="n">my</span><span class="o">+</span><span class="n">mz</span><span class="o">+</span><span class="n">mt</span><span class="p">)</span> <span class="k">return</span>

    <span class="c">! arguments o.k.</span>

    <span class="n">ier</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">jy</span> <span class="o">=</span> <span class="n">mx</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">kz</span> <span class="o">=</span> <span class="n">mx</span><span class="o">+</span><span class="n">my</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">mx</span><span class="o">+</span><span class="n">my</span><span class="o">+</span><span class="n">mz</span><span class="o">+</span><span class="mi">1</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>

        <span class="c">! linearly interpolate in nt, set work space pointers and scales</span>

        <span class="n">l2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">l3</span> <span class="o">=</span> <span class="n">l2</span>
        <span class="n">l4</span> <span class="o">=</span> <span class="n">l3</span><span class="o">+</span><span class="n">mt</span>
        <span class="n">l5</span> <span class="o">=</span> <span class="n">l4</span>
        <span class="n">l6</span> <span class="o">=</span> <span class="n">l5</span>
        <span class="n">l7</span> <span class="o">=</span> <span class="n">l6</span>
        <span class="n">l8</span> <span class="o">=</span> <span class="n">l7</span><span class="o">+</span><span class="n">mxmymz</span>
        <span class="n">l9</span> <span class="o">=</span> <span class="n">l8</span><span class="o">+</span><span class="n">mxmymz</span>
        <span class="k">call </span><span class="n">linmxu</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span><span class="n">mt</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">lt</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l3</span><span class="p">))</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">l9</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
            <span class="c">! linear in z</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">k2</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="n">k3</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k5</span> <span class="o">=</span> <span class="n">k4</span>
            <span class="n">k6</span> <span class="o">=</span> <span class="n">k5</span>
            <span class="n">k7</span> <span class="o">=</span> <span class="n">k6</span>
            <span class="n">k8</span> <span class="o">=</span> <span class="n">k7</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="n">k9</span> <span class="o">=</span> <span class="n">k8</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="k">call </span><span class="n">linmxu</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">kz</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k3</span><span class="p">))</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">k9</span>
        <span class="k">else</span>
            <span class="c">! cubic in z</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">k2</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="n">k3</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k5</span> <span class="o">=</span> <span class="n">k4</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k6</span> <span class="o">=</span> <span class="n">k5</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k7</span> <span class="o">=</span> <span class="n">k6</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="n">k8</span> <span class="o">=</span> <span class="n">k7</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="n">k9</span> <span class="o">=</span> <span class="n">k8</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="k">call </span><span class="n">cubnmxu</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">kz</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k5</span><span class="p">))</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">k9</span><span class="o">+</span><span class="n">mxmy</span>
        <span class="k">end if</span>

<span class="k">        if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
            <span class="c">! linear in y</span>
            <span class="n">j3</span> <span class="o">=</span> <span class="n">j2</span>
            <span class="n">j4</span> <span class="o">=</span> <span class="n">j3</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j5</span> <span class="o">=</span> <span class="n">j4</span>
            <span class="n">j6</span> <span class="o">=</span> <span class="n">j5</span>
            <span class="n">j7</span> <span class="o">=</span> <span class="n">j6</span>
            <span class="n">j8</span> <span class="o">=</span> <span class="n">j7</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">j9</span> <span class="o">=</span> <span class="n">j8</span><span class="o">+</span><span class="n">mx</span>
            <span class="k">call </span><span class="n">linmxu</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">jy</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j3</span><span class="p">))</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="n">j9</span>
        <span class="k">else</span>
            <span class="c">! cubic in y</span>
            <span class="n">j3</span> <span class="o">=</span> <span class="n">j2</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j4</span> <span class="o">=</span> <span class="n">j3</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j5</span> <span class="o">=</span> <span class="n">j4</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j6</span> <span class="o">=</span> <span class="n">j5</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j7</span> <span class="o">=</span> <span class="n">j6</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">j8</span> <span class="o">=</span> <span class="n">j7</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">j9</span> <span class="o">=</span> <span class="n">j8</span><span class="o">+</span><span class="n">mx</span>
            <span class="k">call </span><span class="n">cubnmxu</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">jy</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j5</span><span class="p">))</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="n">j9</span><span class="o">+</span><span class="n">mx</span>
        <span class="k">end if</span>

<span class="k">        if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
            <span class="c">! linear in x</span>
            <span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span>
            <span class="n">i4</span> <span class="o">=</span> <span class="n">i3</span>
            <span class="n">i5</span> <span class="o">=</span> <span class="n">i4</span>
            <span class="k">call </span><span class="n">linmxu</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">iw</span><span class="p">,</span><span class="n">w</span><span class="p">(</span><span class="n">i3</span><span class="p">))</span>
        <span class="k">else</span>
            <span class="c">! cubic in x</span>
            <span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">i4</span> <span class="o">=</span> <span class="n">i3</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">i5</span> <span class="o">=</span> <span class="n">i4</span><span class="o">+</span><span class="n">mx</span>
            <span class="k">call </span><span class="n">cubnmxu</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">iw</span><span class="p">,</span><span class="n">w</span><span class="p">(</span><span class="n">i2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i5</span><span class="p">))</span>
        <span class="k">end if</span>

        <span class="c">! linearly interpolate in t</span>

        <span class="k">call </span><span class="n">lint4u</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">mt</span><span class="p">,</span><span class="n">mxmy</span><span class="p">,</span><span class="n">mxmymz</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">intpol</span><span class="p">,&amp;</span>
                    <span class="n">iw</span><span class="p">(</span><span class="n">lt</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l7</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l8</span><span class="p">),&amp;</span>
                    <span class="n">iw</span><span class="p">(</span><span class="n">kz</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k5</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k6</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k7</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k8</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k9</span><span class="p">),&amp;</span>
                    <span class="n">iw</span><span class="p">(</span><span class="n">jy</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j5</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j6</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j7</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j8</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j9</span><span class="p">),&amp;</span>
                    <span class="n">iw</span><span class="p">,</span><span class="n">w</span><span class="p">(</span><span class="n">i2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i5</span><span class="p">),&amp;</span>
                    <span class="n">inmx</span><span class="p">,</span><span class="n">jnmy</span><span class="p">,</span><span class="n">knmz</span><span class="p">,</span><span class="n">lnmt</span><span class="p">,</span><span class="n">isubx</span><span class="p">,</span><span class="n">jsuby</span><span class="p">,</span><span class="n">ksubz</span><span class="p">,</span><span class="n">lsubt</span><span class="p">)</span>

    <span class="k">else</span>

        <span class="c">! cubically interpolate in t</span>

        <span class="n">l2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">l3</span> <span class="o">=</span> <span class="n">l2</span><span class="o">+</span><span class="n">mt</span>
        <span class="n">l4</span> <span class="o">=</span> <span class="n">l3</span><span class="o">+</span><span class="n">mt</span>
        <span class="n">l5</span> <span class="o">=</span> <span class="n">l4</span><span class="o">+</span><span class="n">mt</span>
        <span class="n">l6</span> <span class="o">=</span> <span class="n">l5</span><span class="o">+</span><span class="n">mt</span>
        <span class="n">l7</span> <span class="o">=</span> <span class="n">l6</span><span class="o">+</span><span class="n">mxmymz</span>
        <span class="n">l8</span> <span class="o">=</span> <span class="n">l7</span><span class="o">+</span><span class="n">mxmymz</span>
        <span class="n">l9</span> <span class="o">=</span> <span class="n">l8</span><span class="o">+</span><span class="n">mxmymz</span>
        <span class="k">call </span><span class="n">cubnmxu</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span><span class="n">mt</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">lt</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l5</span><span class="p">))</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">l9</span><span class="o">+</span><span class="n">mxmymz</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
            <span class="c">! linear in z</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">k2</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="n">k3</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k5</span> <span class="o">=</span> <span class="n">k4</span>
            <span class="n">k6</span> <span class="o">=</span> <span class="n">k5</span>
            <span class="n">k7</span> <span class="o">=</span> <span class="n">k6</span>
            <span class="n">k8</span> <span class="o">=</span> <span class="n">k7</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="n">k9</span> <span class="o">=</span> <span class="n">k8</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="k">call </span><span class="n">linmxu</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">kz</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k3</span><span class="p">))</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">k9</span>
        <span class="k">else</span>
            <span class="c">! cubic in z</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">k2</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="n">k3</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k5</span> <span class="o">=</span> <span class="n">k4</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k6</span> <span class="o">=</span> <span class="n">k5</span><span class="o">+</span><span class="n">mz</span>
            <span class="n">k7</span> <span class="o">=</span> <span class="n">k6</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="n">k8</span> <span class="o">=</span> <span class="n">k7</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="n">k9</span> <span class="o">=</span> <span class="n">k8</span><span class="o">+</span><span class="n">mxmy</span>
            <span class="k">call </span><span class="n">cubnmxu</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">kz</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k5</span><span class="p">))</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">k9</span><span class="o">+</span><span class="n">mxmy</span>
        <span class="k">end if</span>

<span class="k">        if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">j3</span> <span class="o">=</span> <span class="n">j2</span>
            <span class="n">j4</span> <span class="o">=</span> <span class="n">j3</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j5</span> <span class="o">=</span> <span class="n">j4</span>
            <span class="n">j6</span> <span class="o">=</span> <span class="n">j5</span>
            <span class="n">j7</span> <span class="o">=</span> <span class="n">j6</span>
            <span class="n">j8</span> <span class="o">=</span> <span class="n">j7</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">j9</span> <span class="o">=</span> <span class="n">j8</span><span class="o">+</span><span class="n">mx</span>
            <span class="k">call </span><span class="n">linmxu</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">jy</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j3</span><span class="p">))</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="n">j9</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">j3</span> <span class="o">=</span> <span class="n">j2</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j4</span> <span class="o">=</span> <span class="n">j3</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j5</span> <span class="o">=</span> <span class="n">j4</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j6</span> <span class="o">=</span> <span class="n">j5</span><span class="o">+</span><span class="n">my</span>
            <span class="n">j7</span> <span class="o">=</span> <span class="n">j6</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">j8</span> <span class="o">=</span> <span class="n">j7</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">j9</span> <span class="o">=</span> <span class="n">j8</span><span class="o">+</span><span class="n">mx</span>
            <span class="k">call </span><span class="n">cubnmxu</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">iw</span><span class="p">(</span><span class="n">jy</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j5</span><span class="p">))</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="n">j9</span><span class="o">+</span><span class="n">mx</span>
        <span class="k">end if</span>

        <span class="c">! set work space portion and indices which depend on x interpolation</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">intpol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span>
            <span class="n">i4</span> <span class="o">=</span> <span class="n">i3</span>
            <span class="n">i5</span> <span class="o">=</span> <span class="n">i4</span>
            <span class="k">call </span><span class="n">linmxu</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">iw</span><span class="p">,</span><span class="n">w</span><span class="p">(</span><span class="n">i3</span><span class="p">))</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">i4</span> <span class="o">=</span> <span class="n">i3</span><span class="o">+</span><span class="n">mx</span>
            <span class="n">i5</span> <span class="o">=</span> <span class="n">i4</span><span class="o">+</span><span class="n">mx</span>
            <span class="k">call </span><span class="n">cubnmxu</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">iw</span><span class="p">,</span><span class="n">w</span><span class="p">(</span><span class="n">i2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i5</span><span class="p">))</span>
        <span class="k">end if</span>

        <span class="c">! cubically interpolate in t</span>

        <span class="k">call </span><span class="n">cubt4u</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">,</span><span class="n">mz</span><span class="p">,</span><span class="n">mt</span><span class="p">,</span><span class="n">mxmy</span><span class="p">,</span><span class="n">mxmymz</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">intpol</span><span class="p">,&amp;</span>
                    <span class="n">iw</span><span class="p">(</span><span class="n">lt</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l5</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l6</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l7</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l8</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">l9</span><span class="p">),&amp;</span>
                    <span class="n">iw</span><span class="p">(</span><span class="n">kz</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k5</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k6</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k7</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k8</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">k9</span><span class="p">),&amp;</span>
                    <span class="n">iw</span><span class="p">(</span><span class="n">jy</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j5</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j6</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j7</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j8</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">j9</span><span class="p">),&amp;</span>
                    <span class="n">iw</span><span class="p">,</span><span class="n">w</span><span class="p">(</span><span class="n">i2</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i3</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i4</span><span class="p">),</span><span class="n">w</span><span class="p">(</span><span class="n">i5</span><span class="p">),&amp;</span>
                    <span class="n">inmx</span><span class="p">,</span><span class="n">jnmy</span><span class="p">,</span><span class="n">knmz</span><span class="p">,</span><span class="n">lnmt</span><span class="p">,</span><span class="n">isubx</span><span class="p">,</span><span class="n">jsuby</span><span class="p">,</span><span class="n">ksubz</span><span class="p">,</span><span class="n">lsubt</span><span class="p">)</span>

    <span class="k">end if</span>

<span class="k">    end subroutine </span><span class="n">rgrd4u</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>regridpack was developed by Jacob Williams<br>&copy; 2021 
                                          </p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            
            
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>